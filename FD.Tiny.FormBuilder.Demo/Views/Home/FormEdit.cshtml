
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <!--引入gis地图样式-->
    <link rel="stylesheet" type="text/css" href="http://www.cszfp.net:7080/arcgis_js_api/library/3.8/3.8/js/dojo/dijit/themes/tundra/tundra.css" />
    <link rel="stylesheet" type="text/css" href="http://www.cszfp.net:7080/arcgis_js_api/library/3.8/3.8/js/esri/css/esri.css" />
    <!--引入quill样式-->
    <link href="~/Scripts/plug/quill/quill.snow.css" rel="stylesheet" />
    <!-- 引入elementui样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入vue2-scrollbar样式 -->
    <link href="~/Scripts/plug/vue2-scrollbar/style/vue2-scrollbar.css" rel="stylesheet" />
    <!-- 引入iconfont图标库 -->
    <link rel="stylesheet" href="//at.alicdn.com/t/font_804038_kcnofq04oqs.css">

    <link href="~/Content/css/style.css" rel="stylesheet" />
    <link href="~/Content/css/labelTemplate.css" rel="stylesheet" />

    <script src="~/Scripts/plug/vue/vue.js"></script>
    <!-- 引入elementui组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- 引入vue2-scrollbar组件库 -->
    <script src="~/Scripts/plug/vue2-scrollbar/vue2-scrollbar.js"></script>
    <script src="~/Scripts/plug/axios/axios.min.js"></script>
    <script src="~/Scripts/plug/draggable/Sortable.min.js"></script>
    <script src="~/Scripts/plug/draggable/vuedraggable.min.js"></script>
    <script src="~/Scripts/plug/mock/mock.js"></script>
    <script src="~/Scripts/plug/mock/mockData.js"></script>
    <script src="~/Scripts/common/Config.js"></script>
    <script src="~/Scripts/common/common.js"></script>
    <script src="~/Scripts/common/Request.js"></script>
    <!--引入gis地图-->
    <script type="text/javascript" defer="defer" src="http://www.cszfp.net:7080/arcgis_js_api/library/3.8/3.8/init.js"></script>
    <!--引入百度地图V3.0-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=9xaY4e2UlCbkuvNr3rCzgsELWHcjbKeA"></script>
    <!--引入quill.js-->
    <script src="~/Scripts/plug/quill/quill.min.js"></script>

    <script src="~/Scripts/dynamicForm/LabelTemplate.js"></script>
    <script src="~/Scripts/dynamicForm/QuillRtf.js"></script>
    <script src="~/Scripts/dynamicForm/GisMap.js"></script>
    <script src="~/Scripts/dynamicForm/BaiduMap.js"></script>
    <script src="~/Scripts/dynamicForm/DynamicForm.js"></script>

</head>
<body>
    <div class="df-form-edit">
        <el-row style="height:700px;">
            <el-col :span="6">
                <div class="form-config-left">
                    <h4>组件库</h4>
                    <div v-for="(group,index) in formComponents" :key="index">
                        <h5 style="clear:both;">{{group.component_group}}</h5>
                        <draggable v-model="group.component_list" class="config-filter"
                                   :options="{group:{ name:'labelList',  pull:'clone', put:false },
                                              ghostClass:'form-config-center-row-ghost',
                                              sort:false,
                                              animation:300}">
                            <div v-for="(component, _index) in group.component_list" :key="_index" class="form-config-left-item">
                                <span v-text="component.label_name_chs"></span>
                            </div>
                        </draggable>
                    </div>
                </div>
            </el-col>
            <el-col :span="10">
                <h4>表单设计</h4>
                <div style="text-align:right;">
                    <el-button size="medium" v-on:click="formPreviewVisible=true" class="f-button-icon-text">
                        <i class="iconfont icon-yulan"></i><span>预 览</span>
                    </el-button>
                    <el-button type="primary" size="medium" v-on:click="formSetVisible=true" class="f-button-icon-text">
                        <i class="iconfont icon-shezhi"></i><span>设 置</span>
                    </el-button>
                    <el-button type="success" size="medium" class="f-button-icon-text">
                        <i class="iconfont icon--baocun"></i><span>变 量</span>
                    </el-button>
                </div>
                <div class="form-config-center">
                    <draggable v-model="setLableList" v-on:update="updateData" v-on:add="addData"
                               :options="{group:{ name:'labelList',  pull:false, put:true },ghostClass:'form-config-center-row-ghost',animation:300}" style="height:500px;">
                        <div v-for="(label,index) in setLableList" :key="index"
                             v-on:click="settingData(index)"
                             :class="['form-config-center-row',index===currentLabelindex?'row-active':'']">
                            <div v-if="label.control_type==='map_gis'">
                                <label-template :lable-type="label.control_type" class="form-config-center-control" style="margin-left:2.5%;"></label-template>
                            </div>
                            <div v-else-if="label.control_type==='map_baidu'">
                                <label-template :lable-type="label.control_type" class="form-config-center-control" style="margin-left:2.5%;"></label-template>
                            </div>
                            <div v-else-if="label.control_type==='rtf'">
                                <label-template :lable-type="label.control_type" class="form-config-center-control" style="margin-left:2.5%;"></label-template>
                            </div>
                            <el-row v-else>
                                <el-col :span="6">
                                    <label class="form-config-center-label">{{label.label_name_chs}}</label>
                                </el-col>
                                <el-col :span="18">
                                    <label-template :lable-type="label.control_type" class="form-config-center-control"></label-template>
                                </el-col>
                            </el-row>
                        </div>

                    </draggable>
                </div>
            </el-col>
            <el-col :span="8">
                <div class="form-config-right" style="padding:10px;">
                    <h4>组件编辑</h4>
                    <div v-if="labelEditChange">
                        <el-form v-if="currentLabelData.control_type==='input_base'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item label="标签中文名" prop="label_name_chs" :rules="[{ required: true, message: '请输入标签中文名', trigger: 'blur' }]">
                                <el-input v-model="currentLabelData.label_name_chs" placeholder="请输入标签中文名"></el-input>
                            </el-form-item>
                            <el-form-item label="分组名称">
                                <el-input v-model="currentLabelData.group_name" placeholder="请输入分组名称"></el-input>
                            </el-form-item>
                            <el-form-item label="默认值">
                                <el-input v-model="currentLabelData.default_value" placeholder="请输入默认值"></el-input>
                            </el-form-item>
                            <el-form-item label="数据类型">
                                <el-select v-model="currentLabelData.data_type" placeholder="请选择数据类型">
                                    <el-option v-for="(value,key) in DataType" :key="value"
                                               :label="key" :value="value"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="占位文本">
                                <el-input v-model="getLableConfigItem('placeholder').value" placeholder="请输入占位文本"></el-input>
                            </el-form-item>
                            <el-form-item label="是否可清空">
                                <el-radio-group v-model="getLableConfigItem('clearable').value">
                                    <el-radio :label="false">否</el-radio>
                                    <el-radio :label="true">是</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <el-form-item label="是否只读">
                                <el-radio-group v-model="getLableConfigItem('readonly').value">
                                    <el-radio :label="false">否</el-radio>
                                    <el-radio :label="true">是</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='input_autocomplete'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='input_textarea'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='select'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='radio'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='checkbox'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='switch'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='rate'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='slider'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='input_number'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='time'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='date'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='map_baidu'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form v-else-if="currentLabelData.control_type==='map_gis'" :ref="'Form'+currentLabelData.label_id" :model="currentLabelData" label-width="120px">
                            <el-form-item>
                                <el-button type="primary" v-on:click="saveLabelConfig">保存组件</el-button>
                                <el-button type="danger" v-on:click="removeConfig">删除组件</el-button>
                            </el-form-item>
                        </el-form>
                        <quill-rtf v-else-if="currentLabelData.control_type==='rtf'"
                                   :eidt-enabled="true"
                                   :contents="currentLabelData.contents"
                                   v-on:text-change="textChange">
                        </quill-rtf>
                        <div v-else style="padding:150px 0;text-align:center;color:#808080;">
                            请选择一个组件进行编辑
                        </div>
                    </div>
                    
                </div>
            </el-col>
        </el-row>
        <el-dialog title="设置表单" :visible.sync="formSetVisible">
            <el-form :model="customerForm" :rules="customerFormRules" ref="CustomerForm" label-width="100px">
                <el-form-item label="表单名称" prop="form_name">
                    <el-input v-model="customerForm.form_name"></el-input>
                </el-form-item>
                <el-form-item label="所属分类" prop="form_type">
                    <el-select v-model="customerForm.form_type" clearable placeholder="请选择表单分类">
                        <el-option label="查勘表单" value="4005001"></el-option>
                        <el-option label="立项表单" value="4005002"></el-option>
                        <el-option label="询价表单" value="4005003"></el-option>
                        <el-option label="其他表单" value="4005004"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="是否共享" prop="form_share">
                    <el-switch v-model="customerForm.form_share"></el-switch>
                </el-form-item>
                <el-form-item label="描述" prop="form_des">
                    <el-input type="textarea" v-model="customerForm.form_des"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" >确定</el-button>
                    <el-button v-on:click="formSetVisible = false">取消</el-button>
                </el-form-item>
            </el-form>
        </el-dialog>
        <el-dialog title="表单预览"
                   :visible.sync="formPreviewVisible"
                   v-on:open="formPreviewOpen"
                   v-on:close="previewFormFresh"
                   class="f-form-preview-dialog"
                   width="60%">
            <div class="f-form-preview-control">
                <el-button type="primary" size="medium" v-on:click="previewFormSetVisible=true" class="f-button-icon-text">
                    <i class="iconfont icon-jiemiansheji"></i><span>界面设置</span>
                </el-button>
                <el-button type="success" size="medium" v-on:click="submitPreviewForm" class="f-button-icon-text">
                    <i class="iconfont icon-tijiao"></i><span>提交测试</span>
                </el-button>
            </div>
            <el-dialog title="界面设置"
                       :visible.sync="previewFormSetVisible"
                       :modal="false"
                       top="20vh"
                       width="30%">
                <div class="f-form-preview-set-item">
                    <label>标签宽度</label>
                    <el-input-number v-model="labelWidth" :min="40" :max="200" :step="10" v-on:change="previewFormFresh">
                    </el-input-number>
                </div>
                <div class="f-form-preview-set-item">
                    <label>排列样式</label>
                    <el-radio-group v-model="column" v-on:change="previewFormFresh">
                        <el-radio :label="1">一列</el-radio>
                        <el-radio :label="2">两列</el-radio>
                        <el-radio :label="3">三列</el-radio>
                    </el-radio-group>
                </div>
                <div class="f-form-preview-set-item">
                    <label>对齐方式</label>
                    <el-radio-group v-model="align" v-on:change="previewFormFresh">
                        <el-radio label="right">右对齐</el-radio>
                        <el-radio label="left">左对齐</el-radio>
                        <el-radio label="top">顶部对齐</el-radio>
                    </el-radio-group>
                </div>
            </el-dialog>
            <vue-scrollbar classes="dynamic-form-scrollbar" ref="DynamicFormScrollbar">
                <div class="scroll-me">
                    <dynamic-form ref="DynamicForm"
                                  :form-id="formId"
                                  :label-width="labelWidth"
                                  :label-align="align"
                                  :form-column="column"
                                  :base-config="{userId:1,customerId:1,pcaCode:'4307'}"
                                  :on-success="onSuccess"
                                  :on-error="onError"
                                  :on-empty="onEmpty">
                    </dynamic-form>
                </div>
            </vue-scrollbar>
        </el-dialog>
    </div>
    <script src="~/Scripts/Home/FormEdit.js"></script>
</body>
</html>
